name: CI Build Check

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  backend-build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Build backend Docker image
        run: |
          docker build ./backend --file ./backend/Dockerfile --tag ci-backend:latest

      - name: Run backend container for sanity check
        run: |
          docker run -d --name ci-backend-test -p 5000:5000 ci-backend:latest
          sleep 5
          # prosta weryfikacja endpointu
          curl -f http://localhost:5000/api/rates
      - name: Stop and remove backend container
        run: |
          docker stop ci-backend-test
          docker rm ci-backend-test

  frontend-check:
    runs-on: ubuntu-latest
    needs: backend-build
    steps:
      - uses: actions/checkout@v4

      - name: Check frontend files
        run: |
          if [ ! -f ./web/index.html ]; then
            echo "index.html missing!"
            exit 1
          fi
          echo "Frontend files exist."
